generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

model Member {
  idx       Int      @id @default(autoincrement())
  id        String   @unique @db.VarChar(30)
  password  String   @db.VarChar(200)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  memos Memo[]
}

model Memo {
  idx       Int      @id @default(autoincrement())
  memberIdx Int
  title     String?  @db.VarChar(200)
  content   Json?
  text      String?  @db.Text()
  pinned    Boolean  @default(false)
  archived  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  member Member      @relation(fields: [memberIdx], references: [idx], onDelete: Cascade)
  files File[]

  @@index([memberIdx])
  @@index([memberIdx, pinned])
  @@index([memberIdx, archived])
}


enum FileCategory {
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  OTHER
}

model File {
  idx          Int      @id @default(autoincrement())
  memoIdx      Int?
  fileKey      String   @db.Text() @unique
  fileName     String   @db.VarChar(45)
  fileType     String   @db.VarChar(15)
  fileMimeType String   @db.Text()
  fileSize     BigInt
  fileCategory FileCategory @default(OTHER)
  createdAt    DateTime @default(now())

  memo      Memo?      @relation(fields: [memoIdx], references: [idx], onDelete: SetNull)

  @@index([fileKey])
  @@index([memoIdx])
}
